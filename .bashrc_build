#!/bin/bash
py_CONF_OPT="--with-pydebug --with-trace-refs --enable-ipv6"
py_MAKE_OPT="-j 8"

function build() {
    local CWD="$(pwd)"
    local NAME="$1"
    shift
    [[ -z "$NAME" ]] && return
    local PREFIX="${PREFIXPATH}"
    local SRC="${SRCPATH}"
    local SRCPROGRAM="${SRC}/${NAME}"
    local PREFIXPROGRAM="${PREFIX}/${NAME}"
    local BUILDPROGRAM="/tmp/build/${NAME}"
    eval BUILD_TYPE=\${${NAME}_BUILD_TYPE}
    eval CONF_OPT=\${${NAME}_CONF_OPT}
    eval MAKE_OPT=\${${NAME}_MAKE_OPT}
    if [[ $BUILD_TYPE = "" ]]; then
        local BUILD_TYPE="configure"
    fi
    rm -rf "$PREFIXPROGRAM"
    mkdir -p "$PREFIXPROGRAM"
    rm -rf "$BUILDPROGRAM"
    mkdir -p "$BUILDPROGRAM"
    cd "$SRCPROGRAM"
    git pull
    cd "$BUILDPROGRAM"
    if [[ $BUILD_TYPE = "configure" ]]; then
        exe ${SRCPROGRAM}/configure --prefix="${PREFIXPROGRAM}" $CONF_OPT  \
            "$@" && exe make $MAKE_OPT && exe make install
    fi
    cd "$CWD"
}

